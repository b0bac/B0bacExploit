import ftplib
from tqdm import tqdm
from CoreUtils.WeakPasswordScannerEngine import WeakPasswordScanningEngine, ScannerRegister


class FTPPasswordScanner(WeakPasswordScanningEngine):
    def __init__(self, target):
        super().__init__(target)
        self.username_list = [username for username in open(self.username_file, 'r').readlines()]
        self.password_list = [password for password in open(self.password_file, 'r').readlines()]

    def ftp_login(self, host, port, username, password):
        try:
            ftp = ftplib.FTP()
            ftp.connect(host, port, 2)
            # tqdm.write(help(ftp.login(username, password)))
            ftp.login(username, password)
            tqdm.write("\033[1;31m[+] 主机【%s】%s端口 存在FTP弱口令! 【%s   %s】" % (host, str(port), username, password))
        except Exception as exception:
            pass

    def scan(self):
        argments = []
        for target in self.target:
            for username in self.username_list:
                for password in self.password_list:
                    argments.append([target[0], int(target[1]), username.split("\n")[0], password.split("\n")[0]])
        self.percent = self.percent(argments)
        for item in self.percent:
            self.thread_pool.start_new_thread(self.ftp_login, item)
        self.percent.set_description("Scanning")



ScannerRegister("FTPBrute", FTPPasswordScanner)



