import gevent
from tqdm import tqdm
from gevent.lock import BoundedSemaphore
from Configuration.Configuration import APP_CONFIGURATION


class GeventPool:
    def __init__(self, function, *args):
        self.size = APP_CONFIGURATION["GeventCount"]
        self.function = function
        self.args = args
        self.count = 0
        self.lock = BoundedSemaphore(value=1)

    def run(self):
        _list = tqdm(self.args[0])
        for item in _list:
            while True:
                if self.count < self.size:
                    event = gevent.spawn(self.function, item, self.count, self.lock)
                    event.join()
                    break
            _list.set_description("Scanning Processing: %s" % item)



