import json
import requests
from Configuration.Configuration import APP_CONFIGURATION


class DingDingNotice:
    def __init__(self, number):
        self.token = APP_CONFIGURATION["DingDingSetting"]["token"]
        self.url = "https://oapi.dingtalk.com/robot/send?access_token=%s" % self.token
        self.phone = APP_CONFIGURATION["DingDingSetting"]["call"]

    def send_message(self, message):
        base_information = {
            "msgtype": "text",
            "text": {
                "content": "漏洞提醒：%s" % str(message)
            },
            "at": {
                "atMobiles": [
                    self.phone
                ],
                "isAtAll": False  # True
            }
        }
        headers = {'Content-Type': 'application/json'}
        requests.post(self.url, data=json.dumps(base_information), headers=headers)
