import time
import socket
import select
import struct


def CheckSummarize(data):
    length = len(data)
    remainder = length % 2
    summarize = 0
    for i in range(0, length - remainder, 2):
        summarize += (data[i]) + ((data[i + 1]) << 8)
    if remainder:
        summarize += (data[-1])
    summarize = (summarize >> 16) + (summarize & 0xffff)
    summarize += (summarize >> 16)
    result = ~summarize & 0xffff
    result = result >> 8 | (result << 8 & 0xff00)
    return result


def Ping(host):
    source_packet = struct.pack('>BBHHH32s', 8, 0, 0, 0, 1, b'abcdefghijklmnopqrstuvwabcdefghi')
    summarize = CheckSummarize(source_packet)
    source_packet = struct.pack('>BBHHH32s', 8, 0, summarize, 0, 1, b'abcdefghijklmnopqrstuvwabcdefghi')
    pinger = socket.socket(socket.AF_INET, socket.SOCK_RAW, socket.getprotobyname("icmp"))
    pinger.sendto(source_packet, (host, 80))
    start = time.time()
    selector = select.select([pinger], [], [], 3)
    end = time.time()
    if not selector[0]:
        return False
    if (3-(end-start)) <= 0:
        return False
    receive_packet, ipaddress = pinger.recvfrom(1024)
    header = receive_packet[20:28]
    type_id, code, checksum, packet_id, sequence = struct.unpack(">BBHHH", header)
    if type_id == 0 and sequence == 1:
        return True
    else:
        return False


def Port_Tcp_Scan(ip, port):
    scanner = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
    scanner.settimeout(3)
    try:
        scanner.connect((ip, port))
        return True
    except Exception as exception:
        raise exception
